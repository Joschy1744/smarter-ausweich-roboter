{"entries":[{"timestamp":1761753784019,"editorVersion":"7.1.31","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":23665,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":3195,"diffs":[[1,"\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":72,"length1":39,"diffs":[[1,"        \"core\": \"*\"\n"]]},{"start1":156,"length1":39,"diffs":[[1,"        \"README.md\"\n"]]},{"start1":183,"length1":35,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]},{"type":"added","filename":"main.py","value":"def clamp(n: number, min2: number, max2: number):\n    if n < min2:\n        return min2\n    if n > max2:\n        return max2\n    return n\n\ndef on_button_pressed_a():\n    l = readAnalog(sensorLeftPin)\n    r = readAnalog(sensorRightPin)\n    basic.show_string(\"L\")\n    basic.show_number(l)\n    basic.pause(200)\n    basic.show_string(\"R\")\n    basic.show_number(r)\ninput.on_button_pressed(Button.A, on_button_pressed_a)\n\n\"\"\"\n\nLinefollower für Calliope mini V3 + MotionKit 2 (MakeCode – JavaScript)\n\nAnpassbare Parameter oben\n\n\"\"\"\n\"\"\"\n\nBei MotionKit 2 sind die Bewegungs- und Sensorik-Blöcke via Erweiterung verfügbar.\n\nWir nutzen „analoge Sensorwerte\" der Linienfolgesensoren unter der Platine.\n\n\"\"\"\nrightSpeed = 0\nleftSpeed = 0\nturnPWM = 0\nturn = 0\nerror = 0\nnormR = 0\nnormL = 0\ninvertSensors = False\n# linker Linienfolgesensor (Unterseite) – analog\nsensorLeftPin = AnalogPin.P0\n# rechter Linienfolgesensor – analog\nsensorRightPin = AnalogPin.P1\n# PWM Pin für linken Motor – an MotionKit Platine\nmotorLeftPwmPin = AnalogPin.P8\n# Richtung Pin links\nmotorLeftDirPin = DigitalPin.P12\n# PWM Pin für rechten Motor\nmotorRightPwmPin = AnalogPin.P2\n# Richtung Pin rechts\nmotorRightDirPin = DigitalPin.P13\nPWM_MAX = 1023\n# Regelungsparameter\nbaseSpeed = 400\nKp = 0.8\nsensorThreshold = 600\ndef readAnalog(pin: AnalogPin):\n    return pins.analog_read_pin(pin)\ndef writeAnalog(pin2: AnalogPin, value: number):\n    value = clamp(Math.round(value), 0, PWM_MAX)\n    pins.analog_write_pin(pin2, value)\ndef writeDigital(pin3: DigitalPin, value2: number):\n    pins.digital_write_pin(pin3, value2)\ndef setMotor(pwmPin: AnalogPin, dirPin: DigitalPin, speed: number):\n    global PWM_MAX\n    speed = clamp(speed, -PWM_MAX, PWM_MAX)\n    if speed >= 0:\n        writeDigital(dirPin, 0)\n        writeAnalog(pwmPin, speed)\n    else:\n        writeDigital(dirPin, 1)\n        writeAnalog(pwmPin, -speed)\ndef readSensorNorm(pin4: AnalogPin):\n    raw = readAnalog(pin4)\n    if invertSensors:\n        raw = PWM_MAX - raw\n    return raw / PWM_MAX\n\ndef on_forever():\n    global normL, normR, error, turn, turnPWM, leftSpeed, rightSpeed\n    rawL = readAnalog(sensorLeftPin)\n    rawR = readAnalog(sensorRightPin)\n    if invertSensors:\n        rawL = PWM_MAX - rawL\n        rawR = PWM_MAX - rawR\n    L_line = 1 if rawL > sensorThreshold else 0\n    R_line = 1 if rawR > sensorThreshold else 0\n    normL = rawL / PWM_MAX\n    normR = rawR / PWM_MAX\n    error = normL - normR\n    turn = Kp * error\n    turnPWM = turn * PWM_MAX\n    leftSpeed = baseSpeed - turnPWM\n    rightSpeed = baseSpeed + turnPWM\n    leftSpeed = clamp(Math.round(leftSpeed), 0 - PWM_MAX, PWM_MAX)\n    rightSpeed = clamp(Math.round(rightSpeed), 0 - PWM_MAX, PWM_MAX)\n    if L_line == 0 and R_line == 0:\n        setMotor(motorLeftPwmPin, motorLeftDirPin, 0)\n        setMotor(motorRightPwmPin, motorRightDirPin, 0)\n        basic.pause(50)\n        setMotor(motorLeftPwmPin, motorLeftDirPin, -200)\n        setMotor(motorRightPwmPin, motorRightDirPin, 200)\n        basic.pause(80)\n    else:\n        setMotor(motorLeftPwmPin, motorLeftDirPin, leftSpeed)\n        setMotor(motorRightPwmPin, motorRightDirPin, rightSpeed)\n    basic.pause(10)\nbasic.forever(on_forever)\n"}]},{"timestamp":1761754303172,"editorVersion":"7.1.31","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":93,"length1":84,"diffs":[[1,"        \"v3\": \"*\"\n"]]}]}]},{"timestamp":1761830558834,"editorVersion":"7.1.31","changes":[{"type":"edited","filename":"pxt.json","patch":[{"start1":287,"length1":31,"diffs":[[1,"    \"preferredEditor\": \"blocksprj\"\n"]]}]}]},{"timestamp":1761896197486,"editorVersion":"7.1.31","changes":[{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":0,"diffs":[[1,"function clamp (n: number, min: number, max: number) {\n    if (n < min) {\n        return min\n    }\n    if (n > max) {\n        return max\n    }\n    return n\n}\ninput.onButtonPressed(Button.A, function () {\n    let l = readAnalog(sensorLeftPin)\nlet r = readAnalog(sensorRightPin)\nbasic.showString(\"L\")\n    basic.showNumber(l)\n    basic.pause(200)\n    basic.showString(\"R\")\n    basic.showNumber(r)\n})\n"]]},{"start1":401,"length1":57,"diffs":[[1," * Linefollower für Calliope mini V3 + MotionKit 2 (MakeCode – JavaScript)\n * \n * Anpassbare Parameter oben\n"]]},{"start1":517,"length1":85,"diffs":[[1," * Bei MotionKit 2 sind die Bewegungs- und Sensorik-Blöcke via Erweiterung verfügbar.\n * \n * Wir nutzen „analoge Sensorwerte\" der Linienfolgesensoren unter der Platine.\n"]]},{"start1":690,"length1":62,"diffs":[[1,"let rightSpeed = 0\nlet leftSpeed = 0\nlet turnPWM = 0\nlet turn = 0\nlet error = 0\nlet normR = 0\nlet normL = 0\nlet invertSensors = false\n// linker Linienfolgesensor (Unterseite) – analog\nlet sensorLeftPin = AnalogPin.P0\n// rechter Linienfolgesensor – analog\nlet sensorRightPin = AnalogPin.P1\n// PWM Pin für linken Motor – an MotionKit Platine\nlet motorLeftPwmPin = AnalogPin.P8\n// Richtung Pin links\nlet motorLeftDirPin = DigitalPin.P12\n// PWM Pin für rechten Motor\nlet motorRightPwmPin = AnalogPin.P2\n// Richtung Pin rechts\nlet motorRightDirPin = DigitalPin.P13\nlet PWM_MAX = 1023\n// Regelungsparameter\nlet baseSpeed = 400\nlet Kp = 0.8\nlet sensorThreshold = 600\nfunction readAnalog(pin: AnalogPin): number {\n    return pins.analogReadPin(pin)\n"]]},{"start1":1433,"length1":150,"diffs":[[1,"function writeAnalog(pin: AnalogPin, value: number): void {\n    value = clamp(Math.round(value), 0, PWM_MAX)\n    pins.analogWritePin(pin, value)\n"]]},{"start1":1580,"length1":65,"diffs":[[1,"function writeDigital(pin: DigitalPin, value: number): void {\n    pins.digitalWritePin(pin, value)\n"]]},{"start1":1681,"length1":864,"diffs":[[1,"function setMotor(pwmPin: AnalogPin, dirPin: DigitalPin, speed: number): void {\n    speed = clamp(speed, -PWM_MAX, PWM_MAX)\n    if (speed >= 0) {\n        writeDigital(dirPin, 0)\n        writeAnalog(pwmPin, speed)\n    } else {\n        writeDigital(dirPin, 1)\n        writeAnalog(pwmPin, -speed)\n"]]},{"start1":1983,"length1":63,"diffs":[[1,"function readSensorNorm(pin: AnalogPin): number {\n    let raw = readAnalog(pin)\n    if (invertSensors) raw = PWM_MAX - raw\n    return raw / PWM_MAX\n"]]},{"start1":2133,"length1":810,"diffs":[[1,"basic.forever(function () {\n    let rawL = readAnalog(sensorLeftPin)\nlet rawR = readAnalog(sensorRightPin)\nif (invertSensors) {\n        rawL = PWM_MAX - rawL\n        rawR = PWM_MAX - rawR\n"]]},{"start1":2327,"length1":1316,"diffs":[[1,"    let L_line = rawL > sensorThreshold ? 1 : 0\nlet R_line = rawR > sensorThreshold ? 1 : 0\nnormL = rawL / PWM_MAX\n    normR = rawR / PWM_MAX\n    error = normL - normR\n    turn = Kp * error\n    turnPWM = turn * PWM_MAX\n    leftSpeed = baseSpeed - turnPWM\n    rightSpeed = baseSpeed + turnPWM\n    leftSpeed = clamp(Math.round(leftSpeed), 0 - PWM_MAX, PWM_MAX)\n    rightSpeed = clamp(Math.round(rightSpeed), 0 - PWM_MAX, PWM_MAX)\n    if (L_line == 0 && R_line == 0) {\n        setMotor(motorLeftPwmPin, motorLeftDirPin, 0)\nsetMotor(motorRightPwmPin, motorRightDirPin, 0)\nbasic.pause(50)\n        setMotor(motorLeftPwmPin, motorLeftDirPin, -200)\nsetMotor(motorRightPwmPin, motorRightDirPin, 200)\nbasic.pause(80)\n"]]},{"start1":3047,"length1":114,"diffs":[[1,"        setMotor(motorLeftPwmPin, motorLeftDirPin, leftSpeed)\nsetMotor(motorRightPwmPin, motorRightDirPin, rightSpeed)\n"]]},{"start1":3172,"length1":1353,"diffs":[[1,"    basic.pause(10)\n"]]}]}]},{"timestamp":1761896240339,"editorVersion":"7.1.31","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1472,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"Ip50/._rC1T7q~$O_QNm\">l</variable><variable id=\"#bL*ak1%w3ReO0,AvzJk\">r</variable><variable id=\"#u:Q?];#cIIxyG*-%6mg\">invertSensors</variable><variable id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</variable><variable id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</variable><variable id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</variable><variable id=\":C-a#HZQRsAL1RdmU0*J\">normL</variable><variable id=\"T2uvNI^yMwnrH!}*.eO~\">normR</variable><variable id=\"m6:75CEwm_;$biuUCz{S\">error</variable><variable id=\"/|HvkEGN$I20MPay$AM.\">turn</variable><variable id=\"-b03aX}at0ZmrvAG7P]#\">Kp</variable><variable id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</variable><variable id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</variable><variable id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</variable><variable id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</variable><variable id=\"5ER@eueBp`i=A0e1hL=_\">L_line</variable><variable id=\":K)FIv?GDFunGo+.b%B[\">R_line</variable><variable id=\"2N6o^3d13O:Kk*kQv|x4\">sensorLeftPin</variable><variable id=\"7e*zjDm1aOX-5g4Gs9vI\">sensorRightPin</variable><variable id=\"%od4]TNysS5Ez!oY:K,X\">motorLeftPwmPin</variable><variable id=\"]6QM0.UtE}8dSF5wB11{\">motorLeftDirPin</variable><variable id=\"xS$WVxJk5nO9YZ9FiZ6(\">motorRightPwmPin</variable><variable id=\"?c/?~dIITiFQAmbRq`BI\">motorRightDirPin</variable><variable id=\"Cvei-S,QA[pwuk.V|xZn\">sensorThreshold</variable></variables><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\n"]]},{"start1":1544,"length1":74,"diffs":[[1,"</comment><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\n"]]},{"start1":1751,"length1":27036,"diffs":[[1,"</comment><block type=\"device_button_event\" x=\"792\" y=\"20\"><field name=\"NAME\">Button.A</field><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let l = readAnalog(sensorLeftPin)\" numlines=\"1\" declaredvars=\"l\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let r = readAnalog(sensorRightPin)\" numlines=\"1\" declaredvars=\"r\"></mutation><next><block type=\"device_print_message\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"text\"><shadow type=\"text\"><field name=\"TEXT\">L</field></shadow></value><next><block type=\"device_show_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"number\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ip50/._rC1T7q~$O_QNm\">l</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"device_print_message\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"text\"><shadow type=\"text\"><field name=\"TEXT\">R</field></shadow></value><next><block type=\"device_show_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"number\"><block type=\"variables_get\"><field name=\"VAR\" id=\"#bL*ak1%w3ReO0,AvzJk\">r</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"1168\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let rawL = readAnalog(sensorLeftPin)\" numlines=\"1\" declaredvars=\"rawL\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let rawR = readAnalog(sensorRightPin)\" numlines=\"1\" declaredvars=\"rawR\"></mutation><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"#u:Q?];#cIIxyG*-%6mg\">invertSensors</field></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field></block></value></block></value></block></next></block></statement><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let L_line = rawL &gt; sensorThreshold ? 1 : 0\" numlines=\"1\" declaredvars=\"L_line\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let R_line = rawR &gt; sensorThreshold ? 1 : 0\" numlines=\"1\" declaredvars=\"R_line\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\":C-a#HZQRsAL1RdmU0*J\">normL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"T2uvNI^yMwnrH!}*.eO~\">normR</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m6:75CEwm_;$biuUCz{S\">error</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":C-a#HZQRsAL1RdmU0*J\">normL</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T2uvNI^yMwnrH!}*.eO~\">normR</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/|HvkEGN$I20MPay$AM.\">turn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-b03aX}at0ZmrvAG7P]#\">Kp</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m6:75CEwm_;$biuUCz{S\">error</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/|HvkEGN$I20MPay$AM.\">turn</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><value name=\"v92friv3ugope17g9gfo6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field></block></value></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><value name=\"v92friv3ugope17g9gfo6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field></block></value></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5ER@eueBp`i=A0e1hL=_\">L_line</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":K)FIv?GDFunGo+.b%B[\">R_line</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, 0)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, 0)\" numlines=\"1\"></mutation><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, -200)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, 200)\" numlines=\"1\"></mutation><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">80</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></statement><statement name=\"ELSE\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, leftSpeed)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, rightSpeed)\" numlines=\"1\"></mutation></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">10</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"42\" y=\"129\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let invertSensors = false\" numlines=\"1\" declaredvars=\"invertSensors\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"2N6o^3d13O:Kk*kQv|x4\">sensorLeftPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">linker Linienfolgesensor (Unterseite) – analog</comment><data>0;1</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P0</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"7e*zjDm1aOX-5g4Gs9vI\">sensorRightPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">rechter Linienfolgesensor – analog</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P1</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"%od4]TNysS5Ez!oY:K,X\">motorLeftPwmPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">PWM Pin für linken Motor – an MotionKit Platine</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P8</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]6QM0.UtE}8dSF5wB11{\">motorLeftDirPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">Richtung Pin links</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"digital_pin\"><field name=\"pin\">DigitalPin.P12</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"xS$WVxJk5nO9YZ9FiZ6(\">motorRightPwmPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">PWM Pin für rechten Motor</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P2</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"?c/?~dIITiFQAmbRq`BI\">motorRightDirPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">Richtung Pin rechts</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"digital_pin\"><field name=\"pin\">DigitalPin.P13</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1023</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field><comment pinned=\"false\" h=\"80\" w=\"160\">Regelungsparameter</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-b03aX}at0ZmrvAG7P]#\">Kp</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.8</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Cvei-S,QA[pwuk.V|xZn\">sensorThreshold</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function readAnalog(pin: AnalogPin): number {\" line1=\"    return pins.analogReadPin(pin)\" line2=\"}\" numlines=\"3\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function writeAnalog(pin: AnalogPin, value: number): void {\" line1=\"    value = clamp(Math.round(value), 0, PWM_MAX)\" line2=\"    pins.analogWritePin(pin, value)\" line3=\"}\" numlines=\"4\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function writeDigital(pin: DigitalPin, value: number): void {\" line1=\"    pins.digitalWritePin(pin, value)\" line2=\"}\" numlines=\"3\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function setMotor(pwmPin: AnalogPin, dirPin: DigitalPin, speed: number): void {\" line1=\"    speed = clamp(speed, -PWM_MAX, PWM_MAX)\" line2=\"    if (speed &gt;= 0) {\" line3=\"        writeDigital(dirPin, 0)\" line4=\"        writeAnalog(pwmPin, speed)\" line5=\"    } else {\" line6=\"        writeDigital(dirPin, 1)\" line7=\"        writeAnalog(pwmPin, -speed)\" line8=\"    }\" line9=\"}\" numlines=\"10\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function readSensorNorm(pin: AnalogPin): number {\" line1=\"    let raw = readAnalog(pin)\" line2=\"    if (invertSensors) raw = PWM_MAX - raw\" line3=\"    return raw / PWM_MAX\" line4=\"}\" numlines=\"5\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2180\" y=\"20\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><field name=\"function_name\">clamp</field><value name=\"v92friv3ugope17g9gfo6\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">n</field></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">min</field></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">max</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">min</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">min</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">max</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">max</field></block></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":2,"length1":40,"diffs":[[1,"    \"name\": \"MotionKit\",\n"]]},{"start1":287,"length1":44,"diffs":[[1,""]]}]},{"type":"added","filename":"test.ts","value":"// Hier kann man Tests durchführen; diese Datei wird nicht kompiliert, wenn dieses Paket als Erweiterung verwendet wird.\n"}]}],"snapshots":[{"timestamp":1761753784018,"editorVersion":"7.1.31","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"MotionKit\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}},{"timestamp":1761830558829,"editorVersion":"7.1.31","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"Ip50/._rC1T7q~$O_QNm\">l</variable><variable id=\"#bL*ak1%w3ReO0,AvzJk\">r</variable><variable id=\"#u:Q?];#cIIxyG*-%6mg\">invertSensors</variable><variable id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</variable><variable id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</variable><variable id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</variable><variable id=\":C-a#HZQRsAL1RdmU0*J\">normL</variable><variable id=\"T2uvNI^yMwnrH!}*.eO~\">normR</variable><variable id=\"m6:75CEwm_;$biuUCz{S\">error</variable><variable id=\"/|HvkEGN$I20MPay$AM.\">turn</variable><variable id=\"-b03aX}at0ZmrvAG7P]#\">Kp</variable><variable id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</variable><variable id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</variable><variable id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</variable><variable id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</variable><variable id=\"5ER@eueBp`i=A0e1hL=_\">L_line</variable><variable id=\":K)FIv?GDFunGo+.b%B[\">R_line</variable><variable id=\"2N6o^3d13O:Kk*kQv|x4\">sensorLeftPin</variable><variable id=\"7e*zjDm1aOX-5g4Gs9vI\">sensorRightPin</variable><variable id=\"%od4]TNysS5Ez!oY:K,X\">motorLeftPwmPin</variable><variable id=\"]6QM0.UtE}8dSF5wB11{\">motorLeftDirPin</variable><variable id=\"xS$WVxJk5nO9YZ9FiZ6(\">motorRightPwmPin</variable><variable id=\"?c/?~dIITiFQAmbRq`BI\">motorRightDirPin</variable><variable id=\"Cvei-S,QA[pwuk.V|xZn\">sensorThreshold</variable></variables><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\nLinefollower für Calliope mini V3 + MotionKit 2 (MakeCode – JavaScript)\nAnpassbare Parameter oben\n</comment><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\nBei MotionKit 2 sind die Bewegungs- und Sensorik-Blöcke via Erweiterung verfügbar.\nWir nutzen „analoge Sensorwerte\" der Linienfolgesensoren unter der Platine.\n</comment><block type=\"device_button_event\" x=\"792\" y=\"20\"><field name=\"NAME\">Button.A</field><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let l = readAnalog(sensorLeftPin)\" numlines=\"1\" declaredvars=\"l\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let r = readAnalog(sensorRightPin)\" numlines=\"1\" declaredvars=\"r\"></mutation><next><block type=\"device_print_message\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"text\"><shadow type=\"text\"><field name=\"TEXT\">L</field></shadow></value><next><block type=\"device_show_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"number\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ip50/._rC1T7q~$O_QNm\">l</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"device_print_message\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"text\"><shadow type=\"text\"><field name=\"TEXT\">R</field></shadow></value><next><block type=\"device_show_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"number\"><block type=\"variables_get\"><field name=\"VAR\" id=\"#bL*ak1%w3ReO0,AvzJk\">r</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"1168\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let rawL = readAnalog(sensorLeftPin)\" numlines=\"1\" declaredvars=\"rawL\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let rawR = readAnalog(sensorRightPin)\" numlines=\"1\" declaredvars=\"rawR\"></mutation><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"#u:Q?];#cIIxyG*-%6mg\">invertSensors</field></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field></block></value></block></value></block></next></block></statement><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let L_line = rawL &gt; sensorThreshold ? 1 : 0\" numlines=\"1\" declaredvars=\"L_line\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let R_line = rawR &gt; sensorThreshold ? 1 : 0\" numlines=\"1\" declaredvars=\"R_line\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\":C-a#HZQRsAL1RdmU0*J\">normL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"T2uvNI^yMwnrH!}*.eO~\">normR</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m6:75CEwm_;$biuUCz{S\">error</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":C-a#HZQRsAL1RdmU0*J\">normL</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T2uvNI^yMwnrH!}*.eO~\">normR</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/|HvkEGN$I20MPay$AM.\">turn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-b03aX}at0ZmrvAG7P]#\">Kp</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m6:75CEwm_;$biuUCz{S\">error</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/|HvkEGN$I20MPay$AM.\">turn</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><value name=\"v92friv3ugope17g9gfo6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field></block></value></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><value name=\"v92friv3ugope17g9gfo6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field></block></value></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5ER@eueBp`i=A0e1hL=_\">L_line</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":K)FIv?GDFunGo+.b%B[\">R_line</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, 0)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, 0)\" numlines=\"1\"></mutation><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, -200)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, 200)\" numlines=\"1\"></mutation><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">80</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></statement><statement name=\"ELSE\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, leftSpeed)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, rightSpeed)\" numlines=\"1\"></mutation></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">10</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"42\" y=\"129\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let invertSensors = false\" numlines=\"1\" declaredvars=\"invertSensors\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"2N6o^3d13O:Kk*kQv|x4\">sensorLeftPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">linker Linienfolgesensor (Unterseite) – analog</comment><data>0;1</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P0</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"7e*zjDm1aOX-5g4Gs9vI\">sensorRightPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">rechter Linienfolgesensor – analog</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P1</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"%od4]TNysS5Ez!oY:K,X\">motorLeftPwmPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">PWM Pin für linken Motor – an MotionKit Platine</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P8</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]6QM0.UtE}8dSF5wB11{\">motorLeftDirPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">Richtung Pin links</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"digital_pin\"><field name=\"pin\">DigitalPin.P12</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"xS$WVxJk5nO9YZ9FiZ6(\">motorRightPwmPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">PWM Pin für rechten Motor</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P2</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"?c/?~dIITiFQAmbRq`BI\">motorRightDirPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">Richtung Pin rechts</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"digital_pin\"><field name=\"pin\">DigitalPin.P13</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1023</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field><comment pinned=\"false\" h=\"80\" w=\"160\">Regelungsparameter</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-b03aX}at0ZmrvAG7P]#\">Kp</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.8</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Cvei-S,QA[pwuk.V|xZn\">sensorThreshold</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function readAnalog(pin: AnalogPin): number {\" line1=\"    return pins.analogReadPin(pin)\" line2=\"}\" numlines=\"3\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function writeAnalog(pin: AnalogPin, value: number): void {\" line1=\"    value = clamp(Math.round(value), 0, PWM_MAX)\" line2=\"    pins.analogWritePin(pin, value)\" line3=\"}\" numlines=\"4\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function writeDigital(pin: DigitalPin, value: number): void {\" line1=\"    pins.digitalWritePin(pin, value)\" line2=\"}\" numlines=\"3\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function setMotor(pwmPin: AnalogPin, dirPin: DigitalPin, speed: number): void {\" line1=\"    speed = clamp(speed, -PWM_MAX, PWM_MAX)\" line2=\"    if (speed &gt;= 0) {\" line3=\"        writeDigital(dirPin, 0)\" line4=\"        writeAnalog(pwmPin, speed)\" line5=\"    } else {\" line6=\"        writeDigital(dirPin, 1)\" line7=\"        writeAnalog(pwmPin, -speed)\" line8=\"    }\" line9=\"}\" numlines=\"10\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function readSensorNorm(pin: AnalogPin): number {\" line1=\"    let raw = readAnalog(pin)\" line2=\"    if (invertSensors) raw = PWM_MAX - raw\" line3=\"    return raw / PWM_MAX\" line4=\"}\" numlines=\"5\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2180\" y=\"20\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><field name=\"function_name\">clamp</field><value name=\"v92friv3ugope17g9gfo6\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">n</field></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">min</field></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">max</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">min</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">min</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">max</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">max</field></block></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":"","main.py":"def clamp(n: number, min2: number, max2: number):\n    if n < min2:\n        return min2\n    if n > max2:\n        return max2\n    return n\n\ndef on_button_pressed_a():\n    l = readAnalog(sensorLeftPin)\n    r = readAnalog(sensorRightPin)\n    basic.show_string(\"L\")\n    basic.show_number(l)\n    basic.pause(200)\n    basic.show_string(\"R\")\n    basic.show_number(r)\ninput.on_button_pressed(Button.A, on_button_pressed_a)\n\n\"\"\"\n\nLinefollower für Calliope mini V3 + MotionKit 2 (MakeCode – JavaScript)\n\nAnpassbare Parameter oben\n\n\"\"\"\n\"\"\"\n\nBei MotionKit 2 sind die Bewegungs- und Sensorik-Blöcke via Erweiterung verfügbar.\n\nWir nutzen „analoge Sensorwerte\" der Linienfolgesensoren unter der Platine.\n\n\"\"\"\nrightSpeed = 0\nleftSpeed = 0\nturnPWM = 0\nturn = 0\nerror = 0\nnormR = 0\nnormL = 0\ninvertSensors = False\n# linker Linienfolgesensor (Unterseite) – analog\nsensorLeftPin = AnalogPin.P0\n# rechter Linienfolgesensor – analog\nsensorRightPin = AnalogPin.P1\n# PWM Pin für linken Motor – an MotionKit Platine\nmotorLeftPwmPin = AnalogPin.P8\n# Richtung Pin links\nmotorLeftDirPin = DigitalPin.P12\n# PWM Pin für rechten Motor\nmotorRightPwmPin = AnalogPin.P2\n# Richtung Pin rechts\nmotorRightDirPin = DigitalPin.P13\nPWM_MAX = 1023\n# Regelungsparameter\nbaseSpeed = 400\nKp = 0.8\nsensorThreshold = 600\ndef readAnalog(pin: AnalogPin):\n    return pins.analog_read_pin(pin)\ndef writeAnalog(pin2: AnalogPin, value: number):\n    value = clamp(Math.round(value), 0, PWM_MAX)\n    pins.analog_write_pin(pin2, value)\ndef writeDigital(pin3: DigitalPin, value2: number):\n    pins.digital_write_pin(pin3, value2)\ndef setMotor(pwmPin: AnalogPin, dirPin: DigitalPin, speed: number):\n    global PWM_MAX\n    speed = clamp(speed, -PWM_MAX, PWM_MAX)\n    if speed >= 0:\n        writeDigital(dirPin, 0)\n        writeAnalog(pwmPin, speed)\n    else:\n        writeDigital(dirPin, 1)\n        writeAnalog(pwmPin, -speed)\ndef readSensorNorm(pin4: AnalogPin):\n    raw = readAnalog(pin4)\n    if invertSensors:\n        raw = PWM_MAX - raw\n    return raw / PWM_MAX\n\ndef on_forever():\n    global normL, normR, error, turn, turnPWM, leftSpeed, rightSpeed\n    rawL = readAnalog(sensorLeftPin)\n    rawR = readAnalog(sensorRightPin)\n    if invertSensors:\n        rawL = PWM_MAX - rawL\n        rawR = PWM_MAX - rawR\n    L_line = 1 if rawL > sensorThreshold else 0\n    R_line = 1 if rawR > sensorThreshold else 0\n    normL = rawL / PWM_MAX\n    normR = rawR / PWM_MAX\n    error = normL - normR\n    turn = Kp * error\n    turnPWM = turn * PWM_MAX\n    leftSpeed = baseSpeed - turnPWM\n    rightSpeed = baseSpeed + turnPWM\n    leftSpeed = clamp(Math.round(leftSpeed), 0 - PWM_MAX, PWM_MAX)\n    rightSpeed = clamp(Math.round(rightSpeed), 0 - PWM_MAX, PWM_MAX)\n    if L_line == 0 and R_line == 0:\n        setMotor(motorLeftPwmPin, motorLeftDirPin, 0)\n        setMotor(motorRightPwmPin, motorRightDirPin, 0)\n        basic.pause(50)\n        setMotor(motorLeftPwmPin, motorLeftDirPin, -200)\n        setMotor(motorRightPwmPin, motorRightDirPin, 200)\n        basic.pause(80)\n    else:\n        setMotor(motorLeftPwmPin, motorLeftDirPin, leftSpeed)\n        setMotor(motorRightPwmPin, motorRightDirPin, rightSpeed)\n    basic.pause(10)\nbasic.forever(on_forever)\n","pxt.json":"{\n    \"name\": \"MotionKit\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"v3\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"main.py\"\n    ],\n    \"preferredEditor\": \"blocksprj\"\n}\n"}},{"timestamp":1761896197486,"editorVersion":"7.1.31","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable id=\"Ip50/._rC1T7q~$O_QNm\">l</variable><variable id=\"#bL*ak1%w3ReO0,AvzJk\">r</variable><variable id=\"#u:Q?];#cIIxyG*-%6mg\">invertSensors</variable><variable id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</variable><variable id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</variable><variable id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</variable><variable id=\":C-a#HZQRsAL1RdmU0*J\">normL</variable><variable id=\"T2uvNI^yMwnrH!}*.eO~\">normR</variable><variable id=\"m6:75CEwm_;$biuUCz{S\">error</variable><variable id=\"/|HvkEGN$I20MPay$AM.\">turn</variable><variable id=\"-b03aX}at0ZmrvAG7P]#\">Kp</variable><variable id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</variable><variable id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</variable><variable id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</variable><variable id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</variable><variable id=\"5ER@eueBp`i=A0e1hL=_\">L_line</variable><variable id=\":K)FIv?GDFunGo+.b%B[\">R_line</variable><variable id=\"2N6o^3d13O:Kk*kQv|x4\">sensorLeftPin</variable><variable id=\"7e*zjDm1aOX-5g4Gs9vI\">sensorRightPin</variable><variable id=\"%od4]TNysS5Ez!oY:K,X\">motorLeftPwmPin</variable><variable id=\"]6QM0.UtE}8dSF5wB11{\">motorLeftDirPin</variable><variable id=\"xS$WVxJk5nO9YZ9FiZ6(\">motorRightPwmPin</variable><variable id=\"?c/?~dIITiFQAmbRq`BI\">motorRightDirPin</variable><variable id=\"Cvei-S,QA[pwuk.V|xZn\">sensorThreshold</variable></variables><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\nLinefollower für Calliope mini V3 + MotionKit 2 (MakeCode – JavaScript)\nAnpassbare Parameter oben\n</comment><comment x=\"0\" y=\"0\" w=\"480\" h=\"120\">\nBei MotionKit 2 sind die Bewegungs- und Sensorik-Blöcke via Erweiterung verfügbar.\nWir nutzen „analoge Sensorwerte\" der Linienfolgesensoren unter der Platine.\n</comment><block type=\"device_button_event\" x=\"792\" y=\"20\"><field name=\"NAME\">Button.A</field><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let l = readAnalog(sensorLeftPin)\" numlines=\"1\" declaredvars=\"l\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let r = readAnalog(sensorRightPin)\" numlines=\"1\" declaredvars=\"r\"></mutation><next><block type=\"device_print_message\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"text\"><shadow type=\"text\"><field name=\"TEXT\">L</field></shadow></value><next><block type=\"device_show_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"number\"><block type=\"variables_get\"><field name=\"VAR\" id=\"Ip50/._rC1T7q~$O_QNm\">l</field></block></value><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">200</field></shadow></value><next><block type=\"device_print_message\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"text\"><shadow type=\"text\"><field name=\"TEXT\">R</field></shadow></value><next><block type=\"device_show_number\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"number\"><block type=\"variables_get\"><field name=\"VAR\" id=\"#bL*ak1%w3ReO0,AvzJk\">r</field></block></value></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"device_forever\" x=\"1168\" y=\"20\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let rawL = readAnalog(sensorLeftPin)\" numlines=\"1\" declaredvars=\"rawL\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let rawR = readAnalog(sensorRightPin)\" numlines=\"1\" declaredvars=\"rawR\"></mutation><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"#u:Q?];#cIIxyG*-%6mg\">invertSensors</field></block></value><statement name=\"DO0\"><block type=\"variables_set\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field></block></value></block></value></block></next></block></statement><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let L_line = rawL &gt; sensorThreshold ? 1 : 0\" numlines=\"1\" declaredvars=\"L_line\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let R_line = rawR &gt; sensorThreshold ? 1 : 0\" numlines=\"1\" declaredvars=\"R_line\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\":C-a#HZQRsAL1RdmU0*J\">normL</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\".Mj#;`N|%:SrVpS9/?P6\">rawL</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"T2uvNI^yMwnrH!}*.eO~\">normR</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">DIVIDE</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"xK@%-tqSH^6V0LoCMN#,\">rawR</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"m6:75CEwm_;$biuUCz{S\">error</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":C-a#HZQRsAL1RdmU0*J\">normL</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"T2uvNI^yMwnrH!}*.eO~\">normR</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"/|HvkEGN$I20MPay$AM.\">turn</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"-b03aX}at0ZmrvAG7P]#\">Kp</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"m6:75CEwm_;$biuUCz{S\">error</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MULTIPLY</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"/|HvkEGN$I20MPay$AM.\">turn</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">ADD</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"a2=JK2=KdEU2uc[Jb8)p\">turnPWM</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><value name=\"v92friv3ugope17g9gfo6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"n]K(~$JqK!qp[_FS/Ek3\">leftSpeed</field></block></value></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"function_call_output\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><value name=\"v92friv3ugope17g9gfo6\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_js_round\"><field name=\"OP\">round</field><value name=\"ARG0\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"i$?y/afuBW1#vb{TafVu\">rightSpeed</field></block></value></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"math_arithmetic\"><field name=\"OP\">MINUS</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><shadow type=\"math_number\"><field name=\"NUM\">1</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field></block></value></block></value><next><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_operation\"><field name=\"OP\">AND</field><value name=\"A\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\"5ER@eueBp`i=A0e1hL=_\">L_line</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value><value name=\"B\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">EQ</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"variables_get\"><field name=\"VAR\" id=\":K)FIv?GDFunGo+.b%B[\">R_line</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, 0)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, 0)\" numlines=\"1\"></mutation><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">50</field></shadow></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, -200)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, 200)\" numlines=\"1\"></mutation><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">80</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></statement><statement name=\"ELSE\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorLeftPwmPin, motorLeftDirPin, leftSpeed)\" numlines=\"1\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"setMotor(motorRightPwmPin, motorRightDirPin, rightSpeed)\" numlines=\"1\"></mutation></block></next></block></statement><next><block type=\"device_pause\"><value name=\"pause\"><shadow type=\"timePicker\"><field name=\"ms\">10</field></shadow></value></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"pxt-on-start\" x=\"42\" y=\"129\"><statement name=\"HANDLER\"><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let invertSensors = false\" numlines=\"1\" declaredvars=\"invertSensors\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"2N6o^3d13O:Kk*kQv|x4\">sensorLeftPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">linker Linienfolgesensor (Unterseite) – analog</comment><data>0;1</data><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P0</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"7e*zjDm1aOX-5g4Gs9vI\">sensorRightPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">rechter Linienfolgesensor – analog</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P1</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"%od4]TNysS5Ez!oY:K,X\">motorLeftPwmPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">PWM Pin für linken Motor – an MotionKit Platine</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P8</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"]6QM0.UtE}8dSF5wB11{\">motorLeftDirPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">Richtung Pin links</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"digital_pin\"><field name=\"pin\">DigitalPin.P12</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"xS$WVxJk5nO9YZ9FiZ6(\">motorRightPwmPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">PWM Pin für rechten Motor</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"analog_pin\"><field name=\"pin\">AnalogPin.P2</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"?c/?~dIITiFQAmbRq`BI\">motorRightDirPin</field><comment pinned=\"false\" h=\"80\" w=\"160\">Richtung Pin rechts</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"digital_pin\"><field name=\"pin\">DigitalPin.P13</field></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\":8M2?Z*2bYj@7Xx1a)_%\">PWM_MAX</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">1023</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"x}(bcdxfadA2AIf_:!0%\">baseSpeed</field><comment pinned=\"false\" h=\"80\" w=\"160\">Regelungsparameter</comment><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">400</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"-b03aX}at0ZmrvAG7P]#\">Kp</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0.8</field></shadow></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Cvei-S,QA[pwuk.V|xZn\">sensorThreshold</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">600</field></shadow></value><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function readAnalog(pin: AnalogPin): number {\" line1=\"    return pins.analogReadPin(pin)\" line2=\"}\" numlines=\"3\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function writeAnalog(pin: AnalogPin, value: number): void {\" line1=\"    value = clamp(Math.round(value), 0, PWM_MAX)\" line2=\"    pins.analogWritePin(pin, value)\" line3=\"}\" numlines=\"4\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function writeDigital(pin: DigitalPin, value: number): void {\" line1=\"    pins.digitalWritePin(pin, value)\" line2=\"}\" numlines=\"3\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function setMotor(pwmPin: AnalogPin, dirPin: DigitalPin, speed: number): void {\" line1=\"    speed = clamp(speed, -PWM_MAX, PWM_MAX)\" line2=\"    if (speed &gt;= 0) {\" line3=\"        writeDigital(dirPin, 0)\" line4=\"        writeAnalog(pwmPin, speed)\" line5=\"    } else {\" line6=\"        writeDigital(dirPin, 1)\" line7=\"        writeAnalog(pwmPin, -speed)\" line8=\"    }\" line9=\"}\" numlines=\"10\"></mutation><next><block type=\"typescript_statement\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"function readSensorNorm(pin: AnalogPin): number {\" line1=\"    let raw = readAnalog(pin)\" line2=\"    if (invertSensors) raw = PWM_MAX - raw\" line3=\"    return raw / PWM_MAX\" line4=\"}\" numlines=\"5\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"2180\" y=\"20\"><mutation name=\"clamp\" functionid=\"em[0d0psecPO@2,kXTk6\"><arg name=\"n\" id=\"v92friv3ugope17g9gfo6\" type=\"number\"></arg><arg name=\"min\" id=\"mls0t5pr8yfzwwy6o8j\" type=\"number\"></arg><arg name=\"max\" id=\"wamjn9lhhp7kh0gngfic\" type=\"number\"></arg></mutation><field name=\"function_name\">clamp</field><value name=\"v92friv3ugope17g9gfo6\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">n</field></block></value><value name=\"mls0t5pr8yfzwwy6o8j\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">min</field></block></value><value name=\"wamjn9lhhp7kh0gngfic\"><block type=\"argument_reporter_number\"><mutation duplicateondrag=\"true\"></mutation><field name=\"VALUE\">max</field></block></value><statement name=\"STACK\"><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">LT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">min</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">min</field></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow><block type=\"logic_compare\"><field name=\"OP\">GT</field><value name=\"A\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value><value name=\"B\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">max</field></block></value></block></value><statement name=\"DO0\"><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">max</field></block></value></block></statement><next><block type=\"function_return\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" no_return_value=\"false\"></mutation><value name=\"RETURN_VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"argument_reporter_number\"><field name=\"VALUE\">n</field></block></value></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":"","main.py":"def clamp(n: number, min2: number, max2: number):\n    if n < min2:\n        return min2\n    if n > max2:\n        return max2\n    return n\n\ndef on_button_pressed_a():\n    l = readAnalog(sensorLeftPin)\n    r = readAnalog(sensorRightPin)\n    basic.show_string(\"L\")\n    basic.show_number(l)\n    basic.pause(200)\n    basic.show_string(\"R\")\n    basic.show_number(r)\ninput.on_button_pressed(Button.A, on_button_pressed_a)\n\n\"\"\"\n\nLinefollower für Calliope mini V3 + MotionKit 2 (MakeCode – JavaScript)\n\nAnpassbare Parameter oben\n\n\"\"\"\n\"\"\"\n\nBei MotionKit 2 sind die Bewegungs- und Sensorik-Blöcke via Erweiterung verfügbar.\n\nWir nutzen „analoge Sensorwerte\" der Linienfolgesensoren unter der Platine.\n\n\"\"\"\nrightSpeed = 0\nleftSpeed = 0\nturnPWM = 0\nturn = 0\nerror = 0\nnormR = 0\nnormL = 0\ninvertSensors = False\n# linker Linienfolgesensor (Unterseite) – analog\nsensorLeftPin = AnalogPin.P0\n# rechter Linienfolgesensor – analog\nsensorRightPin = AnalogPin.P1\n# PWM Pin für linken Motor – an MotionKit Platine\nmotorLeftPwmPin = AnalogPin.P8\n# Richtung Pin links\nmotorLeftDirPin = DigitalPin.P12\n# PWM Pin für rechten Motor\nmotorRightPwmPin = AnalogPin.P2\n# Richtung Pin rechts\nmotorRightDirPin = DigitalPin.P13\nPWM_MAX = 1023\n# Regelungsparameter\nbaseSpeed = 400\nKp = 0.8\nsensorThreshold = 600\ndef readAnalog(pin: AnalogPin):\n    return pins.analog_read_pin(pin)\ndef writeAnalog(pin2: AnalogPin, value: number):\n    value = clamp(Math.round(value), 0, PWM_MAX)\n    pins.analog_write_pin(pin2, value)\ndef writeDigital(pin3: DigitalPin, value2: number):\n    pins.digital_write_pin(pin3, value2)\ndef setMotor(pwmPin: AnalogPin, dirPin: DigitalPin, speed: number):\n    global PWM_MAX\n    speed = clamp(speed, -PWM_MAX, PWM_MAX)\n    if speed >= 0:\n        writeDigital(dirPin, 0)\n        writeAnalog(pwmPin, speed)\n    else:\n        writeDigital(dirPin, 1)\n        writeAnalog(pwmPin, -speed)\ndef readSensorNorm(pin4: AnalogPin):\n    raw = readAnalog(pin4)\n    if invertSensors:\n        raw = PWM_MAX - raw\n    return raw / PWM_MAX\n\ndef on_forever():\n    global normL, normR, error, turn, turnPWM, leftSpeed, rightSpeed\n    rawL = readAnalog(sensorLeftPin)\n    rawR = readAnalog(sensorRightPin)\n    if invertSensors:\n        rawL = PWM_MAX - rawL\n        rawR = PWM_MAX - rawR\n    L_line = 1 if rawL > sensorThreshold else 0\n    R_line = 1 if rawR > sensorThreshold else 0\n    normL = rawL / PWM_MAX\n    normR = rawR / PWM_MAX\n    error = normL - normR\n    turn = Kp * error\n    turnPWM = turn * PWM_MAX\n    leftSpeed = baseSpeed - turnPWM\n    rightSpeed = baseSpeed + turnPWM\n    leftSpeed = clamp(Math.round(leftSpeed), 0 - PWM_MAX, PWM_MAX)\n    rightSpeed = clamp(Math.round(rightSpeed), 0 - PWM_MAX, PWM_MAX)\n    if L_line == 0 and R_line == 0:\n        setMotor(motorLeftPwmPin, motorLeftDirPin, 0)\n        setMotor(motorRightPwmPin, motorRightDirPin, 0)\n        basic.pause(50)\n        setMotor(motorLeftPwmPin, motorLeftDirPin, -200)\n        setMotor(motorRightPwmPin, motorRightDirPin, 200)\n        basic.pause(80)\n    else:\n        setMotor(motorLeftPwmPin, motorLeftDirPin, leftSpeed)\n        setMotor(motorRightPwmPin, motorRightDirPin, rightSpeed)\n    basic.pause(10)\nbasic.forever(on_forever)\n","pxt.json":"{\n    \"name\": \"MotionKit\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"v3\": \"*\",\n        \"MotionKit V2\": \"github:tinysuperlab/motionkitv2#v0.1.2\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"main.py\"\n    ],\n    \"preferredEditor\": \"blocksprj\"\n}\n"}}],"shares":[],"lastSaveTime":1761896371197}